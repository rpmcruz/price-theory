<!DOCTYPE html>
<html>
<head>
<title>Utility game</title>
<style>
body {width:280px; margin:0 auto;}
#plot {display:inline-block;}
svg circle.face {stroke:black; stroke-width:5px; fill:yellow;}
svg circle.eye {fill:black;}
svg path.smile {stroke:black; stroke-width:5px; fill:none;}
</style>
<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
</head>

<body>
<div id="plot"></div>

$$U(\textbf{g}) = \sum_{i=1}^3 (1-\exp(-\alpha_ig_i)) / 3$$

<p>Bread: <input id="good1" class="good" type="range" value="0" min="-10" max="10" /></p>
<p>Wine: <input id="good2" class="good" type="range" value="0" min="-10" max="10" /></p>
<p>Circus: <input id="good3" class="good" type="range" value="0" min="-10" max="10" /></p>
<p>Utility: <span id="utility">0</span></p>

<script src="../pkgs/d3.min.js"></script>
<script src="../pkgs/econ.utility.js"></script>
<script>
var width = 280, height = 280;

var svg = d3.select('#plot').append('svg')
    .attr('width', width)
    .attr('height', height)
    .append('g')
    .attr('transform', 'translate(' + (width/2) + ',' + (height/2) + ')');

svg.append('circle').attr('class', 'face').attr('r', Math.min(width, height)/2-5);
svg.append('circle').attr('class', 'eye').attr('r', 20).attr('cx', -50).attr('cy', -50);
svg.append('circle').attr('class', 'eye').attr('r', 20).attr('cx', +50).attr('cy', -50);

var smile = [
    {x: -85, y: 0},
    {x: 0, y: 0},
    {x: +85, y: 0},
];

var lineFunction = d3.svg.line()
    .interpolate('monotone')
    .x(function(d) {return d.x;})
    .y(function(d) {return d.y;});

svg.append('path')
    .attr('class', 'smile')
    .attr('transform', 'translate(0, 60)')
    .attr('d', lineFunction(smile));

const utility = new Utility([0.5, 0.5, 0.5]);

d3.selectAll('.good').on('input', function(event) {
    var value = utility.get([
        d3.select('#good1').property('value'),
        d3.select('#good2').property('value'),
        d3.select('#good3').property('value')]);


    smile[0].y = smile[2].y = -30*(value/10);
    svg.selectAll('.smile')
        .transition()
        .ease('linear')
        .duration(200)
        .attr('d', lineFunction(smile));
    d3.select('#utility').text(value.toFixed(3));
});
</script>
</body>
</html>
